var tent=tent||{};tent.global=typeof window=="undefined"?this:window;
tent.Namespace=function(a,b){if(!b)if(a){b=a;a=tent.global}else throw"must specify namespace path";if(b===".."){if(a===tent.global)throw"cannot use '..' at top level";return a.parent}var d=b.indexOf(".");d<0||b.indexOf(".",d+1);var f=a===tent.global?"":a.fullname+"";if(f)f+=".";f+=b;if(d<0)if(typeof a[b]=="undefined"){this.fullname=f;this.name=b;this.parent=a;a[b]=this}else if(!a[b]instanceof tent.Namespace)throw'error creating namespace: "'+f+'" is not a Namespace object';else return a[b];else return new tent.Namespace(new tent.Namespace(a,
b.slice(0,d)),b.slice(d+1));return this};tent.__tentTmp=new tent.Namespace("__tentTmp");tent.__tentTmp.Namespace=tent.Namespace;tent.__tentTmp.fullname="tent";tent.__tentTmp.name="tent";tent.__tentTmp.parent=tent.global;tent.__tentTmp.global=tent.global;tent.global.tent=tent.__tentTmp;delete tent.__tentTmp;try{delete tent.global.__tentTmp}catch(ex){}
tent.Namespace.prototype.expand=function(a){if(a instanceof Function)a(this);else if(typeof a=="object")for(var b in a)if(a.hasOwnProperty(b)){if(typeof this[b]!="undefined")throw this.fullname+"."+b+" already exists";this[b]=a[b]}return this};
tent.declare=function(){for(var a,b=0;b<arguments.length;b++){var d=arguments[b];if(d instanceof tent.Namespace)a=d;else if(typeof d=="string")a=a?new tent.Namespace(a,d):new tent.Namespace(d);else if(d instanceof Function||typeof d=="object"){if(!a)throw"no namespace provided";a.expand(d)}else throw"invalid argument type at index "+b+", expected Namespace, string, Function";}return a};
tent.isDOMObject=function(a){if(typeof Node!="undefined"&&a instanceof Node||typeof Element!="undefined"&&a instanceof Element||typeof NodeList!="undefined"&&a instanceof NodeList||a===window||a===document)return true;if(typeof o==="object"&&typeof o.nodeType==="number"&&typeof o.nodeName==="string")return true;return false};
tent.DOMPropertyNames=["nextSibling","onresizeend","onrowenter","aria-haspopup","childNodes","ondragleave","canHaveHTML","onbeforepaste","ondragover","onbeforecopy","aria-disabled","onpage","recordNumber","previousSibling","nodeName","onbeforeactivate","accessKey","currentStyle","scrollLeft","onbeforeeditfocus","oncontrolselect","aria-hidden","onblur","hideFocus","clientHeight","style","onbeforedeactivate","dir","aria-expanded","onkeydown","nodeType","ondragstart","onscroll","onpropertychange","ondragenter",
"id","aria-level","onrowsinserted","scopeName","lang","onmouseup","aria-busy","oncontextmenu","language","scrollTop","offsetWidth","onbeforeupdate","onreadystatechange","onmouseenter","filters","onresize","isContentEditable","aria-checked","aria-readonly","oncopy","onselectstart","scrollHeight","onmove","ondragend","onrowexit","lastChild","aria-secret","onactivate","canHaveChildren","onfocus","onfocusin","isMultiLine","onmouseover","offsetTop","oncut","parentNode","tagName","className","onmousemove",
"title","role","behaviorUrns","onfocusout","onfilterchange","disabled","parentTextEdit","ownerDocument","offsetParent","aria-posinset","ondrop","ondblclick","onrowsdelete","tabIndex","onkeypress","aria-relevant","onlosecapture","innerText","aria-live","parentElement","ondeactivate","aria-labelledby","aria-pressed","children","ondatasetchanged","ondataavailable","aria-invalid","onafterupdate","nodeValue","onmousewheel","onkeyup","readyState","onmovestart","aria-valuenow","aria-selected","onmouseout",
"aria-owns","aria-valuemax","onmoveend","contentEditable","document","firstChild","sourceIndex","outerText","isTextEdit","isDisabled","oncellchange","runtimeStyle","scrollWidth","aria-valuemin","onlayoutcomplete","onhelp","attributes","offsetHeight","onerrorupdate","onmousedown","clientTop","aria-setsize","clientWidth","onpaste","tagUrn","onmouseleave","onclick","outerHTML","ondrag","aria-controls","onresizestart","aria-flowto","ondatasetcomplete","aria-required","clientLeft","aria-describedby","all",
"onbeforecut","innerHTML","aria-activedescendant","aria-multiselectable","offsetLeft","dataSrc","dataFld","dataFormatAs","name","nextSibling","onresizeend","onrowenter","aria-haspopup","childNodes","ondragleave","canHaveHTML","onbeforepaste","ondragover","onbeforecopy","aria-disabled","onpage","recordNumber","previousSibling","nodeName","onbeforeactivate","accessKey","currentStyle","scrollLeft","onbeforeeditfocus","oncontrolselect","aria-hidden","onblur","hideFocus","clientHeight","style","onbeforedeactivate",
"dir","aria-expanded","onkeydown","nodeType","ondragstart","onscroll","onpropertychange","ondragenter","id","aria-level","onrowsinserted","scopeName","lang","onmouseup","aria-busy","oncontextmenu","language","scrollTop","offsetWidth","onbeforeupdate","onreadystatechange","onmouseenter","filters","onresize","isContentEditable","aria-checked","aria-readonly","oncopy","onselectstart","scrollHeight","onmove","ondragend","onrowexit","lastChild","aria-secret","onactivate","canHaveChildren","onfocus","onfocusin",
"isMultiLine","onmouseover","offsetTop","oncut","parentNode","tagName","className","onmousemove","title","role","behaviorUrns","onfocusout","onfilterchange","disabled","parentTextEdit","ownerDocument","offsetParent","aria-posinset","ondrop","ondblclick","onrowsdelete","tabIndex","onkeypress","aria-relevant","onlosecapture","innerText","aria-live","parentElement","ondeactivate","aria-labelledby","aria-pressed","children","ondatasetchanged","ondataavailable","aria-invalid","onafterupdate","nodeValue",
"onmousewheel","onkeyup","readyState","onmovestart","aria-valuenow","aria-selected","onmouseout","aria-owns","aria-valuemax","onmoveend","contentEditable","document","firstChild","sourceIndex","outerText","isTextEdit","isDisabled","oncellchange","runtimeStyle","scrollWidth","aria-valuemin","onlayoutcomplete","onhelp","attributes","offsetHeight","onerrorupdate","onmousedown","clientTop","aria-setsize","clientWidth","onpaste","tagUrn","onmouseleave","onclick","outerHTML","ondrag","aria-controls","onresizestart",
"aria-flowto","ondatasetcomplete","aria-required","clientLeft","aria-describedby","all","onbeforecut","innerHTML","aria-activedescendant","aria-multiselectable","offsetLeft","dataSrc","dataFld","dataFormatAs","name"];tent.isDOMProperty=function(a){if(!tent.DOMPropertyNames.indexOf)tent.DOMPropertyNames.indexOf=tent.arrays.functions.indexOf;return tent.DOMPropertyNames.indexOf(a)>=0};
tent.domClone=function(a,b){if(a===null)return null;else if(typeof a=="undefined")return;else if(typeof a=="object"){if(b&&b.onlyForTracking&&tent.changes.getPropertyInterceptMode()!=tent.changes.PropertyInterceptModes.DEFINEPROPERTYONLYDOM)return a;if(b){if(b.deep&&!b.deepStack)b.deepStack=tent.arrays.extend([])}else b={};if(a instanceof Array)for(var d=[],f=0;f<a.length;f++)if(b.deep){b.deepStack.push(a);b.deepStack.lastIndexOf(a[f])<0&&d.push(tent.domClone(a[f],b));b.deepStack.pop()}else d.push(a[f]);
else{d=document.createElement("span");for(var g in a)if(!b.clonePrivates&&g.substr(0,1)=="_")d[g]=a[g];else if(b.deep&&typeof a[g]=="object"){b.deepStack.push(a);if(b.deepStack.indexOf(a[f])<0)d[g]=tent.domClone(a[g],b);b.deepStack.pop()}else d[g]=a[g]}return d}return a};tent.declare("tent.arrays",function(){tent.arrays.extend=function(a,b){for(var d in tent.arrays.functions)if(b||!(a[d]instanceof Function))a[d]=tent.arrays.functions[d];return a};tent.arrays.functions={indexOf:function(a){for(var b=0,d=this.length;b<d;b++)if(this[b]===a)return b;return-1},lastIndexOf:function(a){for(var b=this.length-1;b>0;b--)if(this[b]===a)return b;return-1},filter:function(a){for(var b=[],d=0,f=this.length;d<f;d++)a(this[d])&&b.push(this[d]);return b},remove:function(){for(var a,
b=0,d=this.length;b<d;b++)for(var f=0,g=arguments.length;f<g;f++)if(this[b]==arguments[f]){this.splice(b,1);a=true;b--;d--;break}if(a)return true;return false},set:function(a,b){this.splice(a,1,b)},pushUnique:function(){if(arguments.length==1){for(var a=false,b=0,d=this.length;b<d;b++)if(this[b]==arguments[0]){a=true;break}a||this.push(arguments[0])}else{a=[];b=0;for(d=this.length;b<d;b++)for(var f=0,g=arguments.length;f<g;f++)if(this[b]==arguments[f])a[f]=true;f=0;for(g=arguments.length;f<g;f++)a[f]||
this.push(arguments[f])}return this.length},clone:function(){var a=[];Array.prototype.push.apply(a,this);return a},isCloneOf:function(a){if(!a)return false;if(this.length!=a.length)return false;if(this===a)return false;for(var b=this.length;b>=0;b--)if(this[b]!==a[b])return false;return true}}});tent.declare("tent.coreTypes",function(){tent.coreTypes.Enum=function(){this.__names__=[];this.__values__={};this.__flags__=false;this.__enum=true;arguments.length>0&&this.add.apply(this,arguments)};tent.coreTypes.Enum.prototype.getName=function(d){if(this.__names__)if(this.__names__[d])return this.__names__[d];else if(this.__flags__){d=d;var f="",g;for(g in this.__values__)if(this.__values__[g]&&(this.__values__[g]&d)===this.__values__[g]){d-=this.__values__[g];if(f)f+="|";f+=g}if(f&&d===0)return f;
else if(f)return f+"|"+d}};tent.coreTypes.Enum.prototype.__freeValue__=function(){var d=typeof this.__maxValue__=="undefined"?1:this.__maxValue__+1;if(this.__values__&&typeof this.__values__[d]!="undefined")for(var f in this.__values__)if(this.__values__[f]>=d){this.__maxValue__=this.__values__[f];d=this.__values__[f]+1}if(this.__flags__)d=d<1?1:Math.pow(2,Math.ceil(Math.log(d)/Math.log(2)));return d};tent.coreTypes.Enum.prototype.useFlags=function(d){this.__flags__=d;return this};var a=function(d,
f,g){d[f]=g;d.__values__[f]=g;if(typeof d.__names__[g]=="undefined")d.__names__[g]=f;if(typeof d.__maxValue__=="undefined"||d.__maxValue__<g)d.__maxValue__=g};tent.coreTypes.Enum.prototype.add=function(){if(arguments.length<1)return this;for(var d,f,g=0,j=arguments.length;g<j;g++){d=arguments[g];if(d instanceof Array)this.add.apply(this,d);else if(typeof d=="object")for(f in d)if(d.hasOwnProperty(f)){var c=this.__values__[f];if(!c instanceof Number||typeof this.__names__[c]!="undefined")c=this.__freeValue__();
a(this,f,c)}if(typeof d=="string")if(d){d=d.split(",");c=0;for(var e=d.length;c<e;c++){f=d[c].replace(/^\s+/g,"").replace(/\s+$/g,"");if(f=="_FLAGS")this.useFlags(true);else{if(typeof this.__values__[f]!="undefined")if(this.__values__[f]instanceof Number)throw"Enum duplicate name found: "+f;else throw"Enum invalid name (reserved): "+f;if(c==e-1&&g<j-1&&typeof arguments[g+1]=="number"){a(this,f,arguments[g+1]);g++}else a(this,f,this.__freeValue__())}}}}return this};var b=function(){var d=this._name+
(this._count>1?"("+this._count+")":"");if(this._childrenCount){d+="{";var f=0,g;for(g in this)if(g.substr(0,1)!="_"&&typeof this[g]=="object"){if(f>0)d+=", ";d+=this[g];f++}d+="}"}return d};tent.coreTypes.NameCounter=function(d){this.root={_name:d||"",_count:0,toString:b}};tent.coreTypes.NameCounter.prototype.__nodeAdd__=function(d,f){d._count=(d._count||0)+f;if(d._parent){if(d._count==0&&!d._childrenCount){d._parent._childrenCount&&d._parent._childrenCount--;delete d._parent[d._name]}this.__nodeAdd__(d._parent,
f)}};tent.coreTypes.NameCounter.prototype.add=function(d,f){if(typeof f!="number")f=1;for(var g=d.split("."),j=this.root,c=0;c<g.length;c++){if(typeof j[g[c]]=="undefined"){j._childrenCount=(j._childrenCount||0)+1;j[g[c]]={_parent:j,_name:g[c],_count:0,toString:b}}j=j[g[c]]}this.__nodeAdd__(j,f)};tent.coreTypes.NameCounter.prototype.reset=function(){this.root={_name:this.root._name,_count:0,toString:b}};tent.coreTypes.NameCounter.prototype.toString=function(){return b.apply(this.root)}});tent.declare("tent.logging",function(){tent.logging.Levels=new tent.coreTypes.Enum("TRACE,DEBUG,INFO,WARN,ERROR,FATAL");tent.logging.Log=function(){this.listeners=[]};tent.logging.Log.prototype.bindToConsole=function(a){typeof console!="undefined"&&this.bind(tent.logging.consoleLogger,a);return this};tent.logging.Log.prototype.bindToAlert=function(a){this.bind(tent.logging.alertLogger,a);return this};tent.logging.Log.prototype.bindToHtml=function(a,b){this.bind(tent.logging.createHtmlAppendLogger(a),
b);return this};tent.logging.Log.prototype.unbindConsole=function(){typeof console!="undefined"&&this.unbind(tent.logging.consoleLogger);return this};tent.logging.Log.prototype.unbindAlert=function(){this.unbind(tent.logging.alertLogger,level);return this};tent.logging.Log.prototype.unbindHtml=function(a){for(var b=this.listeners.length;b>=0;b--)this.listeners[b].callback.outputElement===a&&this.listeners.splice(b,1);return this};tent.logging.Log.prototype.bind=function(a,b){if(!a instanceof Function)throw"a callback Function must be provided";
var d=b;if(typeof d!="number")d=typeof d=="undefined"?tent.logging.Levels.TRACE:tent.logging.Levels[d]||tent.logging.Levels.TRACE;for(var f=false,g=this.listeners.length-1;g>=0;g--){var j=this.listeners[g];if(j.callback===a){j.level=d;f=true}}f||this.listeners.push({callback:a,level:d});return this};tent.logging.Log.prototype.unbind=function(a){if(!a instanceof Function)throw"a callback Function must be provided";for(var b=this.listeners.length;b>=0;b--)this.listeners[b].callback===a&&this.listeners.splice(b,
1);return this};tent.logging.Log.prototype.notify=function(a,b){var d=b;if(typeof d!="number")d=d?tent.logging.Levels[d]||tent.logging.Levels.INFO:tent.logging.Levels.INFO;for(var f=0,g=this.listeners.length;f<g;f++){var j=this.listeners[f];if(j.callback)if(typeof j.level=="undefined"||j.level<=d)j.callback(a,b)}};tent.logging.Log.prototype.trace=function(){this.notify(this.stringOrStringify.apply(this,arguments),tent.logging.Levels.TRACE)};tent.logging.Log.prototype.debug=function(){this.notify(this.stringOrStringify.apply(this,
arguments),tent.logging.Levels.DEBUG)};tent.logging.Log.prototype.info=function(){this.notify(this.stringOrStringify.apply(this,arguments),tent.logging.Levels.INFO)};tent.logging.Log.prototype.warn=function(){this.notify(this.stringOrStringify.apply(this,arguments),tent.logging.Levels.WARN)};tent.logging.Log.prototype.error=function(){this.notify(this.stringOrStringify.apply(this,arguments),tent.logging.Levels.ERROR)};tent.logging.Log.prototype.fatal=function(){this.notify(this.stringOrStringify.apply(this,
arguments),tent.logging.Levels.FATAL)};tent.logging.Log.prototype.stringify=function(){var a="";try{var b=arguments.length>0&&arguments[arguments.length-1]&&arguments[arguments.length-1]._options?arguments[arguments.length-1]:{_options:true};if(!b.deepStack){b.deepStack=[];tent.arrays.extend(b.deepStack)}for(var d=0,f=arguments.length;d<f;d++)if(!(arguments[d]&&typeof arguments[d]=="object"&&arguments[d]._options))if(!(arguments[d]instanceof Function)){if(a)a+=", ";if(b.deepStack.length>3||b.deepStack.lastIndexOf(arguments[d])>=
0)a+="#";else if(typeof arguments[d]=="undefined")a+="undefined";else if(arguments[d]==null)a+="null";else if(arguments[d]instanceof Array){var g=tent.arrays.functions.clone.apply(arguments[d]).filter(function(h){if(h instanceof Function)return false;if(b.deepStack.lastIndexOf(h>=0))return false;return true});g.push(b);b.deepStack.push(arguments[d]);a+="[";if(b.deepStack.length<4)a+=this.stringify.apply(this,g);b.deepStack.pop();a+="]"}else if(typeof arguments[d]=="string")a+='"'+arguments[d]+'"';
else if(arguments[d]instanceof Date)a+='"'+arguments[d]+'"';else if(typeof arguments[d]=="object"){var j="";b.deepStack.push(arguments[d]);if(b.deepStack.length<4)for(var c in arguments[d])if(!(arguments[d][c]instanceof Function))if(!(b.deepStack.lastIndexOf(arguments[d][c])>=0)){if(j)j+=", ";j+='"'+c+'": '+this.stringify.apply(this,[arguments[d][c],b])}b.deepStack.pop();a+="{"+j+"}"}else a+=arguments[d]}}catch(e){return"#err#"}return a};tent.logging.Log.prototype.stringOrStringify=function(){return arguments.length==
1&&typeof arguments[0]=="string"?arguments[0]:this.stringify.apply(this,arguments)};tent.logging.consoleLogger=function(a,b){if(b==tent.logging.Levels.TRACE)console.trace?console.trace(a):console.info(a);if(b==tent.logging.Levels.DEBUG)console.debug?console.debug(a):console.info(a);b==tent.logging.Levels.INFO&&console.info(a);if(b==tent.logging.Levels.WARN)console.warn?console.warn(a):console.info(a);b==tent.logging.Levels.ERROR&&console.error(a);b==tent.logging.Levels.FATAL&&console.error(a)};tent.logging.alertLogger=
function(a){alert(a)};tent.logging.createHtmlAppendLogger=function(a){var b=null;b=a.tagName=="INPUT"?function(d,f){a.value+="\n["+tent.logging.Levels.getName(f)+"] "+d}:a.tagName=="UL"?function(d,f){var g=document.createElement("li");g.innerHTML="["+tent.logging.Levels.getName(f)+"] "+d;a.appendChild(g)}:a.tagName=="TABLE"?function(d,f){var g=document.createElement("tr"),j=document.createElement("td");j.setAttribute("class","eventType");j.innerHTML=tent.logging.Levels.getName(f);g.appendChild(j);
j=document.createElement("td");j.setAttribute("class","eventMessage");j.innerHTML=d.replace(/(\<)/g,"&lt;").replace(/(\>)/g,"&gt;").replace(/(\&)/g,"&amp;").replace(/(\s)/g,"&nbsp;");g.appendChild(j);a.tBodies[0].appendChild(g)}:function(d,f){a.innerHTML+="<br/>["+tent.logging.Levels.getName(f)+"] "+d};b.outputElement=a;return b};tent.log=(new tent.logging.Log).bindToConsole()});tent.declare("tent.changes",function(){tent.changes.EventTypes=new tent.coreTypes.Enum("ANY,MANYCHANGES,CHANGING,CHANGED,ADDING,ADDED,REMOVING,REMOVED");tent.changes.InterceptorTypes=new tent.coreTypes.Enum("PROPERTY,FUNCTION");tent.changes.PropertyInterceptModes=new tent.coreTypes.Enum("NONE,DEFINESETTER,DEFINEPROPERTY,DEFINEPROPERTYONLYDOM");var a;tent.changes.getPropertyInterceptMode=function(){if(typeof a=="undefined"){var c={};if(Object.defineProperty)try{Object.defineProperty(c,"myproperty",
{get:function(){return this._myproperty},set:function(k){this._myproperty=k}});c.myproperty="my value";if(c.myproperty==="my value"&&c._myproperty==="my value")a=tent.changes.PropertyInterceptModes.DEFINEPROPERTY}catch(e){if(document&&document.createElement){c=document.createElement("span");try{Object.defineProperty(c,"myproperty",{get:function(){return this._myproperty},set:function(k){this._myproperty=k}});c.myproperty="my value";if(c.myproperty==="my value"&&c._myproperty==="my value")a=tent.changes.PropertyInterceptModes.DEFINEPROPERTYONLYDOM}catch(h){}}}if(typeof a==
"undefined"){c={};if(c.__defineSetter__)try{c.__defineGetter__("myproperty",function(){return this._myproperty});c.__defineSetter__("myproperty",function(k){this._myproperty=k});c.myproperty="my value";if(c.myproperty==="my value"&&c._myproperty==="my value")a=tent.changes.PropertyInterceptModes.DEFINESETTER}catch(i){}}if(typeof a=="undefined")a=tent.changes.PropertyInterceptModes.NONE}return a};tent.changes.getPropertyInterceptModeName=function(){return tent.changes.PropertyInterceptModes.getName(tent.changes.getPropertyInterceptMode())};
tent.changes.Change=function(c,e,h){this.subject=c;this.eventType=e;this.data=h};tent.changes.ChangeStringifiers=[];tent.changes.Change.prototype.toString=function(){if(typeof tent.changes.ChangeStringifiers[this.eventType]!="undefined")tent.changes.ChangeStringifiers[this.eventType](this);else{var c=tent.changes.EventTypes.getName(this.eventType);if(this.eventType==tent.changes.EventTypes.MANYCHANGES){c+=": ";if(this.data.length<=3)for(var e=0,h=this.data.length;e<h;e++)c+=this.data[e].toString()+
",";else{var i={};e=0;for(h=this.data.length;e<h;e++)i[this.data[e].eventType]=(i[this.data[e].eventType]||0)+1;for(var k in i)c+=tent.changes.EventTypes.getName(k)+"("+i[k]+"),"}}else{if(this.data.propertyName){c+=" "+this.data.propertyName;if(this.eventType==tent.changes.EventTypes.CHANGING)c+=" from "+this.data.current+" to "+this.data.newValue;else if(this.eventType==tent.changes.EventTypes.CHANGED)c+=" from "+this.data.oldValue+" to "+this.data.current;c+=" (on "+this.subject+")"}if(this.data.items){e=
this.data.items;c+=" "+e.length+(e.length>1?" items":" item");if(typeof this.data.index!="undefined")c+=" at index "+this.data.index;c+=this.data.propertyName?" ("+this.subject.__parent__+"."+this.data.propertyName+")":" (["+e+"])"}}return"[Change: "+c+"]"}};tent.changes.Observable=function(c){this.subject=c;this.handlers={};this.interceptors={};this.suspended=false;this.changesWhileSuspended=null};tent.changes.Observable.prototype.interceptFunction=function(c,e){if(!this.interceptors[c]){var h="_"+
c,i={name:c,_name:h,type:tent.changes.InterceptorTypes.FUNCTION};this.subject[h]=this.subject[c];this.subject[c]=e;this.interceptors[c]=i}};tent.pset=function(c,e,h){if(c.__observable__&&c.__observable__.interceptors&&c.__observable__.interceptors[e])c.__observable__.interceptors[e].newsetter.call(c,h);else c[e]=h;return h};tent.pget=function(c,e){return c.__observable__&&c.__observable__.interceptors&&c.__observable__.interceptors[e]?c.__observable__.interceptors[e].newgetter.call(c):c[e]};tent.changes.Observable.prototype.interceptProperty=
function(c,e,h,i){if(this.interceptors[c])return this.interceptors[c];var k={name:c,type:tent.changes.InterceptorTypes.PROPERTY,newsetter:i,newgetter:h};if(e){e="_"+c;try{this.subject[e]=this.subject[c]}catch(m){this.subject[e]=null}k._name=e}e=tent.changes.getPropertyInterceptMode();if(e==tent.changes.PropertyInterceptModes.DEFINEPROPERTY||e==tent.changes.PropertyInterceptModes.DEFINEPROPERTYONLYDOM&&tent.isDOMObject(this.subject)){try{k.descriptor=Object.getOwnPropertyDescriptor(this.subject,c)}catch(l){}e=
{};if(h)e.get=h;if(i)e.set=i;try{Object.defineProperty(this.subject,c,e)}catch(n){tent.log.warn("Object.defineProperty for property '"+c+"' failed: "+n)}}else if(e==tent.changes.PropertyInterceptModes.DEFINESETTER){try{k.getter=this.subject.__lookupGetter__(c);k.setter=this.subject.__lookupSetter__(c)}catch(p){}if(h)try{this.subject.__defineGetter__(c,h)}catch(q){tent.log.warn("Object.__defineGetter__ for property '"+c+"' failed: "+q)}if(i)try{this.subject.__defineSetter__(c,i)}catch(r){tent.log.warn("Object.__defineSetter__ for property '"+
c+"' failed: "+r)}}if(k)this.interceptors[c]=k;return k};var b=function(c,e){return function(h){var i=this[e];if(i!=h){this.__observable__.notifyChange(tent.changes.EventTypes.CHANGING,{propertyName:c,current:i,newValue:h});this[e]=h;this.__observable__.notifyChange(tent.changes.EventTypes.CHANGED,{propertyName:c,current:h,oldValue:i})}}},d=function(c,e){return function(){return this[e]}},f=function(c,e){return e.substr(0,1)!="_"};tent.changes.Observable.prototype.interceptProperties=function(c){c||
(c={});var e=c.propertyFilter||f,h=c.backPropertyPrefix||"_";!c.trackDomProperties&&this.isDOMObject();for(var i in this.subject)if(!tent.isDOMProperty(i))try{if(typeof this.subject[i]!="function"&&e(this.subject,i)){c=h+i;this.interceptProperty(i,c,d(i,c),b(i,c))}}catch(k){tent.log.warn("Error intercepting property '"+i+"': "+k)}return this};tent.changes.Observable.prototype.isDOMObject=function(){if(typeof this._isDomObject=="undefined")this._isDOMObject=tent.isDOMObject(this.subject);return this._isDOMObject};
tent.changes.Observable.prototype.interceptArrayModifiers=function(){if(!this.subject instanceof Array)return this;var c=this.subject;this.subject.setLength=function(e){if(this.length>e)this.splice(e,this.length-e);else this.lengh=e};this.interceptFunction("push",function(){var e=this.length,h=h=Array.prototype.slice.call(arguments);this.__observable__.notifyChange(tent.changes.EventTypes.ADDING,{items:h,index:e,propertyName:this.__propertyName__});this._push.apply(this,arguments);this.__observable__.notifyChange(tent.changes.EventTypes.ADDED,
{items:h,index:e,propertyName:this.__propertyName__})});this.interceptFunction("unshift",function(){var e=e=Array.prototype.slice.call(arguments);this.__observable__.notifyChange(tent.changes.EventTypes.ADDING,{items:e,index:0,propertyName:this.__propertyName__});this._unshift.apply(this,arguments);this.__observable__.notifyChange(tent.changes.EventTypes.ADDED,{items:e,index:0,propertyName:this.__propertyName__})});this.interceptFunction("pop",function(){var e=this.length-1;this.__observable__.notifyChange(tent.changes.EventTypes.REMOVING,
{items:[this[e]],index:e,propertyName:this.__propertyName__});var h=this._pop();this.__observable__.notifyChange(tent.changes.EventTypes.REMOVED,{items:[h],index:e,propertyName:this.__propertyName__});return h});this.interceptFunction("shift",function(){this.__observable__.notifyChange(tent.changes.EventTypes.REMOVING,{items:[this[0]],index:0,propertyName:this.__propertyName__});var e=this._shift();this.__observable__.notifyChange(tent.changes.EventTypes.REMOVED,{items:[e],index:0,propertyName:this.__propertyName__});
return e});this.interceptFunction("splice",function(e,h){var i;h&&h>0&&this.__observable__.notifyChange(tent.changes.EventTypes.REMOVING,{items:this.slice(e,e+h),index:e,propertyName:this.__propertyName__});if(arguments.length>2){i=Array.prototype.slice.call(arguments,2);this.__observable__.notifyChange(tent.changes.EventTypes.ADDING,{items:i,index:e,propertyName:this.__propertyName__})}if(i&&i.length>0){var k=i.slice(0);k.unshift(e,h);k=this._splice.apply(this,k)}else k=this._splice(e,h);k&&k.length>
0&&this.__observable__.notifyChange(tent.changes.EventTypes.REMOVED,{items:k,index:e,propertyName:this.__propertyName__});arguments.length>2&&this.__observable__.notifyChange(tent.changes.EventTypes.ADDED,{items:i,index:e,propertyName:this.__propertyName__});return k});c.remove=tent.arrays.functions.remove;c.set=tent.arrays.functions.set;if(!c.indexOf)c.indexOf=tent.arrays.functions.indexOf;if(!c.lastIndexOf)c.lastIndexOf=tent.arrays.functions.lastIndexOf;return this};tent.changes.Observable.prototype.removeInterceptor=
function(c){var e=this.interceptors[c];if(e._name){if(e.type!=tent.changes.InterceptorTypes.FUNCTION){try{delete this.subject[e.name]}catch(h){tent.log.warn("Error deleting property interceptor '"+e.name+"': "+h)}var i=tent.changes.getPropertyInterceptMode();if(i==tent.changes.PropertyInterceptModes.DEFINEPROPERTY||i==tent.changes.PropertyInterceptModes.DEFINEPROPERTYONLYDOM&&tent.isDOMObject(this.subject))e.descriptor&&e.descriptor.name&&Object.defineProperty(this.subject,c,e.descriptor);else if(i==
tent.changes.PropertyInterceptModes.DEFINESETTER){e.getter&&this.subject.__defineGetter__(c,e.getter);e.setter&&this.subject.__defineSetter__(c,e.setter)}}try{this.subject[e.name]=this.subject[e._name]}catch(k){(i=tent.isDOMObject(this.subject))||tent.log.warn("Error restoring property '"+e.name+"' value: "+k)}try{delete this.subject[e._name]}catch(m){tent.log.warn("Error deleting back storage property '"+e._name+"': "+m)}}else if(e.type!=tent.changes.InterceptorTypes.FUNCTION){i=this.subject[e.name];
delete this.subject[e.name];this.subject[e.name]=i}delete e[c]};tent.changes.Observable.prototype.removeInterceptors=function(){for(var c in this.interceptors)try{this.removeInterceptor(c)}catch(e){tent.log.warn("Error removing interceptor from property '"+c+"': "+e)}this.interceptors={}};tent.changes.Observable.prototype.suspend=function(){this.suspended=true};tent.changes.Observable.prototype.resume=function(){this.suspended=false;if(this.changesWhileSuspended){if(this.changesWhileSuspended.length<
5)for(var c=0,e=this.changesWhileSuspended.length;c<e;c++)this.notifyChange(this.changesWhileSuspended[c]);else this.changesWhileSuspended.length>1&&this.notifyChange(tent.changes.EventTypes.MANYCHANGES,this.changesWhileSuspended);delete this.changesWhileSuspended}};tent.changes.Observable.prototype.isValidHandler=function(c){if(!c)return false;if(typeof c=="function"||typeof c=="object"&&typeof c.handle=="function")return true;return false};tent.changes.Observable.prototype.bind=function(c,e){if(!e)if(this.isValidHandler(c)){e=
c;c=tent.changes.EventTypes.ANY}else throw"must specify a handler: function (Change) or and object with a handle(Change) function";if(!this.isValidHandler(e))throw"must specify a handler: function (Change) or and object with a handle(Change) function";if(!c)c=tent.changes.EventTypes.ANY;var h=this.handlers[c];h||(h=this.handlers[c]=[]);for(var i=0;i<h.length;i++)if(h[i]==e)return false;this.handlers[c].push(e);return true};tent.changes.Observable.prototype.unbind=function(c,e){if(!e)if(this.isValidHandler(c)){e=
c;c=tent.changes.EventTypes.ANY}else throw"must specify a handler to remove";if(!this.isValidHandler(e))throw"must specify a handler to remove";if(!c)c=tent.changes.EventTypes.ANY;var h=this.handlers[c],i=false;if(h)for(var k=0,m=h.length;k<m;k++)if(h[k]==e){h.splice(k,1);k--;m--;i=true}return i};tent.changes.Observable.prototype.unbindWhere=function(c){var e=false,h;for(h in this.handlers)for(var i=this.handlers[h],k=0,m=i.length;k<m;k++)if(c(i[k])){i.splice(k,1);k--;m--;e=true}return e};tent.changes.Observable.prototype.notifyHandler=
function(c,e){try{return typeof e=="function"?e.call(this.subject,c):e.handle(c)}catch(h){var i="";if(h.stack)i+=h.stack;else if(h.message)i+=h.message;tent.log.error("Change Handler Error: "+h+(i?"\n"+i:""));return h}};tent.changes.Observable.prototype.notifyChange=function(c,e){if(this.suspended){if(!this.changesWhileSuspended){this.changesWhileSuspended=[];if(!this.changesWhileSuspended.filter)this.changesWhileSuspended.filter=tent.arrays.functions.filter;this.changesWhileSuspended.findByEventType=
function(){for(var l=0,n=this.length;l<n;l++)for(var p=0,q=arguments.length;p<q;p++)if(this[l].eventType==arguments[p])return this[l]};this.changesWhileSuspended.findPropertyChanged=function(l,n){for(var p=0,q=this.length;p<q;p++)if(this[p].subject==l&&this[p].eventType==tent.changes.EventTypes.CHANGED&&this[p].data.propertyName==n)return this[p]};this.changesWhileSuspended.findArrayChanged=function(){for(var l=0,n=this.length;l<n;l++)if(this[l].subject==subject&&(this[l].eventType==tent.changes.EventTypes.ADDED||
this[l].eventType==tent.changes.EventTypes.REMOVED))return this[l]}}this.changesWhileSuspended.push(new tent.changes.Change(this.subject,c,e))}else{var h;h=c instanceof tent.changes.Change?c:new tent.changes.Change(this.subject,c,e);var i=this.handlers[c];if(i)for(var k=0,m=i.length;k<m;k++)this.notifyHandler(h,i[k]);if(i=this.handlers[tent.changes.EventTypes.ANY]){k=0;for(m=i.length;k<m;k++)this.notifyHandler(h,i[k])}}};var g;tent.changes.Observable.prototype.log=function(c){if(typeof c=="undefined")c=
true;if(c){g||(g=new tent.changes.LogHandler);return this.bind(g)}else if(g)return this.unbind(g);return false};tent.changes.LogHandler=function(c){if(typeof c=="undefined")c="";else if(c&&c[c.length-1]!=" ")c+=" ";this.prefix=c};tent.changes.LogHandler.prototype.handle=function(c){tent.log.info(this.prefix+c.toString())};var j=function(c){var e={};for(opName in c)if(opName!="deepStack"&&opName!="liveHandler")e[opName]=c[opName];c=function(h){if(h.eventType==tent.changes.EventTypes.CHANGED){if(typeof h.data.current==
"object")if(e.deepOverDOM||!tent.isDOMObject(h.data.current)){e.deepStack=[h.data.subject];tent.changes.track(h.data.current,e);delete e.deepStack}}else if(h.eventType==tent.changes.EventTypes.ADDED)for(var i=0,k=h.data.items.length;i<k;i++)if(typeof h.data.items[i]=="object")if(e.deepOverDOM||!tent.isDOMObject(h.data.current)){e.deepStack=[h.data.subject];tent.changes.track(h.data.items[i],e);delete e.deepStack}};c.isLivePropagator=true;return c};tent.changes.track=function(c,e){e||(e={});if(typeof c!=
"object"){if(!e.deepStack)throw"Cannot track changes of "+typeof c;return false}else if(c==null){if(!e.deepStack)throw"Cannot track changes of null";return false}var h=c instanceof Array,i=false;if(!e.remove&&!e.removeAll&&!c.__observable__){if(e.observable&&(!e.observable.subject||e.observable.subject==c)){c.__observable__=e.observable;c.__observable__.subject=c}else c.__observable__=new tent.changes.Observable(c);i=true;if(!e.interceptOptions)e.interceptOptions={};h?c.__observable__.interceptArrayModifiers(e.interceptOptions):
c.__observable__.interceptProperties(e.interceptOptions)}if(e.bindings)for(var k=0,m=e.bindings.length;k<m;k++){var l=e.bindings[k];if(h&&l.bindArrays!=false||!h&&l.bindObjects!=false)if(e.remove){if(c.__observable__&&c.__observable__.unbind(l.eventType,l.handler))i=true}else if(c.__observable__.bind(l.eventType,l.handler))i=true}if(e.log)if(c.__observable__&&c.__observable__.log(!e.remove))i=true;if(e.reverseProperties)if(e.remove){if(c.__observable__&&c.__observable__.unbind(tent.changes.reverseProperties.getHandler()))i=
true}else if(c.__observable__.bind(tent.changes.reverseProperties.getHandler()))i=true;if(e.removeAll&&c.__observable__){c.__observable__.removeInterceptors();delete c.__observable__.subject;delete c.__observable__;i=true}if(e.deep&&e.live&&!e.remove)if(e.remove){if(c.__observable__.unbindWhere(function(p){return p.isLivePropagator}))i=true}else{if(!e.liveHandler)e.liveHandler=j(e);if(c.__observable__.bind(e.liveHandler))i=true}if(e.deep){if(e.deepStack)e.deepStack.push(c);else{e.deepStack=[c];if(!e.deepStack.lastIndexOf)e.deepStack.lastIndexOf=
tent.arrays.functions.lastIndexOf}if(h){k=0;for(m=c.length;k<m;k++)if((h=c[k])&&typeof h=="object"&&e.deepStack.lastIndexOf(h)<0)if(tent.changes.track(h,e))i=true}else{k=e.propertyFilter||f;for(var n in c)if(typeof c[n]!="function"&&k(c,n)){h=c[n];if(e.deepOverDOM||!tent.isDOMObject(subject))if(typeof h=="object"&&e.deepStack.lastIndexOf(h)<0)if(tent.changes.track(h,e))i=true}}e.deepStack.pop()}return i};tent.changes.untrack=function(c,e){if(e){if(!e.removeAll)e.removeAll=true}else e={removeAll:true};
return tent.changes.track(c,e)};tent.changes.isTracked=function(c){return c.__observable__&&c.__observable__ instanceof tent.changes.Observable};tent.changes.bind=function(c,e){var h;if(typeof e=="string"){h=e;e={bindings:[]}}else if(typeof e=="function")e={bindings:[{handler:e}]};else if(typeof e=="object"&&typeof e.handle=="function")e={bindings:[{handler:e}]};if(arguments.length>2){if(e){if(!e.bindings)e.bindings=[]}else e={bindings:[]};for(var i=2;i<arguments.length;i++)e.bindings.push({eventType:h,
handler:arguments[i]})}return tent.changes.track(c,e)};tent.changes.unbind=function(c,e){var h;if(typeof e=="string"){h=e;e={bindings:[]}}else if(typeof e=="function")e={bindings:[{handler:e}]};else if(typeof e=="object"&&typeof e.handle=="function")e={bindings:[{handler:e}]};if(arguments.length>2){if(e){if(!e.bindings)e.bindings=[]}else e={bindings:[]};for(var i=2;i<arguments.length;i++)e.bindings.push({eventType:h,handler:arguments[i]})}if(e){if(!e.remove)e.remove=true}else e={remove:true};return tent.changes.track(c,
e)}});tent.declare("tent.databinding",function(){var a=function(d,f,g,j,c){var e={};e.handle=function(h){var i=false;if(h.eventType==tent.changes.EventTypes.ADDED||h.eventType==tent.changes.EventTypes.REMOVED||h.eventType==tent.changes.EventTypes.CHANGED)if(c.deep)i=true;else{var k=d;if(h.subject==d)i=true;else for(var m=f.split("."),l=0;l<m.length;l++){var n=m[l];k=k[n];if(k==h.subject){i=true;break}}}else if(h.eventType==tent.changes.EventTypes.MANYCHANGES)i=true;if(i){h=d;k=null;if(f){m=f.split(".");
for(l=0;l<m.length;l++){n=m[l];k=h;h=h[n];if(h==null||typeof h=="undefined")break;else tent.changes.bind(h,{live:c.live,log:c.log,deepStack:[k],bindings:[{eventType:tent.changes.EventTypes.CHANGED,handler:this}]})}}m=g;if(n=j){k=j.split(".");for(l=0;l<k.length;l++){n=k[l];tgtParent=m;m=m[n];if(m==null||typeof m=="undefined"){if(l<k.length-1)i=false;break}}m=tgtParent}if(i)if(c.template)tent.databinding.parseTemplate(c.template,h,m,n);else{if(typeof c.format=="function")h=c.format(h);if(m[n]!=h)m[n]=
h}}};return e};tent.databinding.bind=function(d,f,g,j,c){c||(c={});var e=a(d,f,g,j,c);if(c.deep){if(c.bidirectional)throw"cannot use bidirectional databinding when using a deep tracking";tent.changes.bind(d,{deep:true,live:c.live,log:c.log,bindings:[{handler:e}]})}else{if(c.bidirectional){if(c.template)throw"cannot use bidirectional databinding when using a template";var h=a(g,j,d,f,c);tent.changes.bind(g,{live:c.live,log:c.log,bindings:[{eventType:tent.changes.EventTypes.CHANGED,handler:h}]})}tent.changes.bind(d,
{live:c.live,log:c.log,bindings:[{eventType:tent.changes.EventTypes.CHANGED,handler:e}]})}d=!f?d:d[f];if(c.template)tent.databinding.parseTemplate(c.template,d,g,j);else if(g[j]!=d)g[j]=d};var b={};tent.databinding.parseTemplate=function(d,f,g,j){var c;try{var e=b[d];if(!e){var h="var p=[],print=function (){p.push.apply(p,arguments);};with(obj){p.push('"+d.replace(/[\r\t\n]/g," ").replace(/'(?=[^#]*#>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<#=(.+?)#>/g,"',$1,'").split("<#").join("');").split("#>").join("p.push('")+
"');}return p.join('');";e=new Function("obj",h);b[d]=e}c=e(f)}catch(i){c="< # ERROR: "+i.message+" # >"}if(g)if(j)g[j]=c;else g.innerHTML=c;return c}});tent.declare("tent.changes.reverseProperties",function(){tent.changes.reverseProperties.setReverseProperty=function(b,d,f){f||(f={});f.cardinality=f.cardinality?f.cardinality.toLowerCase():"11";if(!f.reverse)f.reverse=d+"Of";var g={name:f.reverse,cardinality:f.cardinality};if(f.cardinality.substr(0,1)==="n"||f.cardinality.substr(0,1)==="m")g.isArray=true;if(!b.__reverseProperties__)b.__reverseProperties__={};if(f.cardinality.substr(1,1)==="n"||f.cardinality.substr(1,1)==="m"){if(typeof b[d]=="undefined"||
!(b[d]instanceof Array))b[d]=[];b.__reverseProperties__[d]=g;b[d].__parent__=b;b[d].__reverseProperty__=g}else{if(typeof b[d]=="undefined")b[d]=null;b.__reverseProperties__[d]=g}};tent.changes.reverseProperties.setReverseProperties=function(b,d){if(d)for(var f in d)d[f].reverse&&tent.changes.reverseProperties.setReverseProperty(b,f,d[f])};tent.changes.reverseProperties.Set=function(b){this.properties=b};tent.changes.reverseProperties.Set.prototype.create=function(){var b={};this.applyTo(b);return b};
tent.changes.reverseProperties.Set.prototype.applyTo=function(){var b=[];b.bind=function(f){f||(f={});f.reverseProperties=true;for(var g=0;g<this.length;g++){var j=this[g];if(j.__reverseProperties__){tent.changes.bind(j,f);var c=j.__reverseProperties__,e;for(e in c)if(c.hasOwnProperty(e))if(c[e].cardinality&&(c[e].cardinality[1]=="n"||c[e].cardinality[1]=="m")){if(!(j[e]instanceof Array)){j[e]=[];j[e].__parent__=j;j[e].__reverseProperty__=j.__reverseProperties__[e]}tent.changes.bind(j[e],f)}}}};if(this.properties){for(var d=
0;d<arguments.length;d++)tent.changes.reverseProperties.setReverseProperties(arguments[d],this.properties);b.push.apply(b,arguments)}return b};var a;tent.changes.reverseProperties.getHandler=function(){a||(a=function(b){if(b.eventType==tent.changes.EventTypes.ADDED){var d=b.data.items;if(d&&b.subject&&b.subject.__reverseProperty__){var f=b.subject.__reverseProperty__;b=b.subject.__parent__;for(var g=0,j=d.length;g<j;g++){var c=d[g];if(f.isArray){c[f.name]||(c[f.name]=[]);c[f.name].indexOf(b)<0&&c[f.name].push(b)}else if(c[f.name]!=
b){if(typeof c[f.name]!="undefined"&&c[f.name]!=null)throw Error("this."+f.name+" is set. Remove this from its current array before adding it to this array");c[f.name]=b}}}}else if(b.eventType==tent.changes.EventTypes.REMOVED){if((d=b.data.items)&&b.subject&&b.subject.__reverseProperty__){f=b.subject.__reverseProperty__;b=b.subject.__parent__;g=0;for(j=d.length;g<j;g++){c=d[g];if(f.isArray){if(c=c[f.name])for(var e=0,h=c.length;e<h;e++)if(c[e]===b){c.splice(e,1);e--;h--}}else if(c[f.name]===b)c[f.name]=
null}}}else if(b.eventType==tent.changes.EventTypes.CHANGED)if(b.data.propertyName&&b.subject&&b.subject.__reverseProperties__)if(f=b.subject.__reverseProperties__[b.data.propertyName])if(f.isArray){if(c=b.data.oldValue){c=c[f.name];if(c instanceof Array){g=0;for(j=c.length;g<j;g++)if(c[g]===b.subject){c.splice(g,1);g--;j--}}}if(c=b.data.current){c[f.name]||(c[f.name]=[]);c[f.name]instanceof Array&&c[f.name].indexOf(b.subject)<0&&c[f.name].push(b.subject)}}else{if(c=b.data.oldValue)if(c[f.name]==
b.subject)c[f.name]=null;if(c=b.data.current)if(c[f.name]!=b.subject)c[f.name]=b.subject}});return a}});tent.declare("tent.entities",function(){tent.entities.ChangeStates=new tent.coreTypes.Enum("DETACHED,UNCHANGED,ADDED,MODIFIED,DELETED");tent.entities.Type=function(a,b){this.name=a;this.properties=b;if(b instanceof tent.changes.reverseProperties.Set)this.reversePropertySet=b;else if(typeof b=="object")this.reversePropertySet=new tent.changes.reverseProperties.Set(b);else throw"cannot create a Type without properties";};tent.entities.Type.prototype.toString=function(){return"EntityType("+this.name+
")"};tent.entities.Type.prototype.applyTo=function(){this.reversePropertySet.applyTo.apply(this.reversePropertySet,arguments);for(var a=0;a<arguments.length;a++){if(arguments[a].__entityType__!=this)arguments[a].__entityType__=this;for(var b in this.properties){var d=this.properties[b];if(typeof arguments[a][b]=="undefined")arguments[a][b]=!d.cardinality||d.cardinality.substr(1,1)==="1"?null:[]}}};tent.entities.Collection=function(a,b,d){this.context=a;this.type=b;this.name=d||b.name;this.items=[];
tent.arrays.extend(this.items)};tent.entities.Collection.prototype.push=function(){for(var a=0;a<arguments.length;a++)if(arguments[a]instanceof Array)this.push.apply(this,arguments[a]);else if(arguments[a].__collection__){if(arguments[a].__collection__!=this)throw"cannot add this object, it already belongs to another Collection";}else{if(arguments[a].__entityType__){if(arguments[a].__entityType__!=this.type)throw'cannot add an object with EntityType "'+arguments[a].__entityType__.name+'" to this collection';
}else this.type&&this.type.applyTo(arguments[a]);if(this.items.lastIndexOf(arguments[a])<0){arguments[a].__collection__=this;this.items.push(arguments[a]);this.context.changeHandler&&this.context.changeHandler.itemAdded(arguments[a]);this.type&&this.context.__cascadePush__(arguments[a])}}return this.items.length};tent.entities.Collection.prototype.attach=function(){for(var a=0;a<arguments.length;a++)if(arguments[a]instanceof Array)throw"cannot attach arrays to a Collection";else if(arguments[a].__collection__){if(arguments[a].__collection__!=
this)throw"cannot attach this object, it already belongs to another Collection";}else{if(arguments[a].__entityType__){if(arguments[a].__entityType__!=this.type)throw'cannot add an object with EntityType "'+arguments[a].__entityType__.name+'" to this collection';}else this.type&&this.type.applyTo(arguments[a]);if(this.items.lastIndexOf(arguments[a])<0){arguments[a].__collection__=this;arguments[a].__changeState__!=tent.entities.ChangeStates.DELETED&&this.items.push(arguments[a]);this.context.changeHandler&&
this.context.changeHandler.itemAttached(arguments[a]);this.type&&this.context.__cascadeAttach__(arguments[a])}}return this.items.length};tent.entities.Collection.prototype.remove=function(){for(var a=false,b=0,d=arguments.length;b<d;b++){var f=arguments[b];if(this.items.remove(f)){a=true;this.context.changeHandler&&this.context.changeHandler.itemRemoved(arguments[b]);this.type&&this.context.__cascadeRemove__(f)}}return a};tent.entities.Collection.prototype.detach=function(){for(var a=false,b=0,d=
arguments.length;b<d;b++){var f=arguments[b];if(this.items.remove(f)||f.__changeState__==tent.entities.ChangeStates.DELETED){a=true;this.context.changeHandler&&this.context.changeHandler.itemDetached(f);delete f.__collection__;f.__entityType__&&this.context.__cascadeDetach__(f)}}return a};tent.entities.Collection.prototype.detachAll=function(){if(this.items.length<1)return false;for(var a=this.items.pop();typeof a!="undefined";){this.context.changeHandler&&this.context.changeHandler.itemDetached(a);
delete a.__collection__;a.__entityType__&&this.context.__cascadeDetach__(a);a=this.items.pop()}this.items.length=0;return true};tent.entities.Context=function(a){this.__collections__={};this.__types__={};a===true&&this.trackChanges();this.changes=null};tent.entities.MyContext=new tent.entities.Context;tent.entities.Context.prototype.all=function(){var a=[],b;for(b in this.__collections__)a.push.apply(a,this.__collections__[b].items);return a};tent.entities.Context.prototype.filter=function(a){var b=
[],d;for(d in this.__collections__)b.push.apply(b,this.__collections__[d].items.filter(a));return b};tent.entities.Context.prototype.contains=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b)if(b.__collection__){if(this.__collections__[b.__collection__.name]!=b.__collection__)return false}else if(b instanceof tent.entities.Type){if(this.__types__[b.name]!=b)return false}else if(b instanceof tent.entities.Collection){if(this!=b.context)return false}else return false;else return false}return true};
tent.entities.Context.prototype.createCollection=function(a,b){if(b){if(a&&!a instanceof tent.entities.Type)throw"provided type is not a Type instance";}else if(a)if(a instanceof tent.entities.Type)b=a.name;else if(typeof a=="string"){b=a;a=null}else throw"provide a Type or name to create a Collection";else b="_Object";if(!this.__collections__[b]){this.__collections__[b]=new tent.entities.Collection(this,a,b);for(var d=b;this[d];)d+="_";this[d]=this.__collections__[b]}return this.__collections__[b]};
tent.entities.Context.prototype.pushModel=function(a){if(a)if(a.types)for(var b in a.types)this.push(new tent.entities.Type(b,a.types[b]))};tent.entities.Context.prototype.push=function(){for(var a=0;a<arguments.length;a++)if(arguments[a]instanceof Array)throw"cannot push arrays into a Context";else if(arguments[a].__collection__){if(arguments[a].__collection__.context!=this)throw"cannot push this item, it belongs to another Context";}else if(arguments[a]instanceof tent.entities.Type){if(!arguments[a].name)throw"cannot add an EntityType without name";
if(this.__types__[arguments[a].name])if(this.__types__[arguments[a].name]==arguments[a])continue;else throw'EntityType "'+arguments[a].name+'" already exists';this.__types__[arguments[a].name]=arguments[a];this.createCollection(arguments[a])}else if(arguments[a]instanceof tent.entities.Context)throw"cannot add an EntityContext to an EntityContext";else if(typeof arguments[a]=="object"){var b=arguments[a].__entityType__;if(b)if(this.__types__[b.name]){if(this.__types__[b.name]!=b)throw'cannot add, object EntityType "'+
b.name+'" differs from the Context one';}else this.__types__[b.name]=b;this.createCollection(b).push(arguments[a])}};tent.entities.Context.prototype.attach=function(){for(var a=0;a<arguments.length;a++)if(arguments[a]instanceof Array)throw"cannot attach arrays";else if(arguments[a].__collection__){if(arguments[a].__collection__.context!=this)throw"cannot attach this item, it belongs to another Context";}else if(arguments[a]instanceof tent.entities.Type)throw"cannot attach EntityTypes";else if(arguments[a]instanceof
tent.entities.Context)throw"cannot attach an EntityContext to an EntityContext";else if(typeof arguments[a]=="object"){var b=arguments[a].__entityType__;if(b)if(this.__types__[b.name]){if(this.__types__[b.name]!=b)throw'cannot add, object EntityType "'+b.name+'" differs from the Context one';}else this.__types__[b.name]=b;this.createCollection(b).attach(arguments[a])}};tent.entities.Context.prototype.remove=function(){for(var a=0;a<arguments.length;a++)if(arguments[a]instanceof tent.entities.Type)throw"cannot remove EntityTypes";
else if(arguments[a]instanceof tent.entities.Context)throw"cannot remove an EntityContext from an EntityContext";else typeof arguments[a]=="object"&&arguments[a].__collection__&&arguments[a].__collection__.remove(arguments[a])};tent.entities.Context.prototype.detach=function(){for(var a=0;a<arguments.length;a++){if(arguments[a]instanceof Array)throw"cannot detach arrays";if(arguments[a]instanceof tent.entities.Type)throw"cannot detach EntityTypes";else if(arguments[a]instanceof tent.entities.Context)throw"cannot detach an EntityContext from an EntityContext";
else typeof arguments[a]=="object"&&arguments[a].__collection__&&arguments[a].__collection__.detach(arguments[a])}};tent.entities.Context.prototype.detachAll=function(){for(var a=false,b=0;b<this.__collections__.length;b++)if(this.__collections__[b].detachAll())a=true;return a};tent.entities.Context.prototype.touch=function(){if(this.changeHandler)return this.changeHandler.touch.apply(this.changeHandler,arguments)};tent.entities.Context.prototype.__cascadePush__=function(){for(var a=0;a<arguments.length;a++){var b=
arguments[a];if(b.__entityType__)for(var d in b.__entityType__.properties)if(b[d]!==null&&typeof b[d]=="object"){var f=b.__entityType__.properties[d];if(f.cascadePush){var g=null;if(f.collection)g=this.__collections__[f.collection]||this.createCollection(f.collection);if(b[d]instanceof Array){if(f.cardinality&&f.cardinality[1]!="1")g?g.push.apply(g,b[d]):this.push.apply(this,b[d])}else g?g.push(b[d]):this.push(b[d])}}}};tent.entities.Context.prototype.__cascadeAttach__=function(){for(var a=0;a<arguments.length;a++){var b=
arguments[a];if(b.__entityType__)for(var d in b.__entityType__.properties)if(b[d]!==null&&typeof b[d]=="object"){var f=b.__entityType__.properties[d];if(f.cascadeAttach){var g=null;if(f.collection)g=this.__collections__[f.collection]||this.createCollection(f.collection);if(b[d]instanceof Array){if(f.cardinality&&f.cardinality[1]!="1")g?g.attach.apply(g,b[d]):this.attach.apply(this,b[d])}else g?g.attach(b[d]):this.attach(b[d])}}}};tent.entities.Context.prototype.__cascadeRemove__=function(){for(var a=
0;a<arguments.length;a++){var b=arguments[a];if(b.__entityType__)for(var d in b.__entityType__.properties)if(b[d]!==null&&typeof b[d]=="object"){var f=b.__entityType__.properties[d];if(f.cascadeRemove)if(b[d]instanceof Array)f.cardinality&&f.cardinality[1]!="1"&&this.remove.apply(this,b[d]);else this.remove(b[d])}}};tent.entities.Context.prototype.__cascadeDetach__=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b.__entityType__)for(var d in b.__entityType__.properties)if(b[d]!==
null&&typeof b[d]=="object"){var f=b.__entityType__.properties[d];if(f.cascadeDetach)if(b[d]instanceof Array)f.cardinality&&f.cardinality[1]!="1"&&this.detach.apply(this,b[d]);else this.detach(b[d])}}};tent.entities.Context.prototype.trackChanges=function(){if(!this.changeHandler){this.changeHandler=new tent.entities.ContextChangeHandler(this);this.changeHandler.init()}};tent.entities.Context.prototype.hasChanges=function(){return!!(this.changes&&this.changes.items.length>0)};tent.entities.Context.prototype.acceptChanges=
function(){this.changeHandler&&this.changeHandler.acceptChanges()};tent.entities.EntityLink=function(a,b,d,f){this.from=a;this.to=b;this.propertyName=d;this.__changeState__=f||tent.entities.ChangeStates.DETACHED};tent.entities.ContextChanges=function(a){this.context=a;this.items=[];tent.arrays.extend(this.items)};tent.entities.ContextChanges.prototype.toString=function(){for(var a=new tent.coreTypes.NameCounter,b=0,d=this.items.length;b<d;b++)a.add(tent.entities.ChangeStates.getName(this.items[b].__changeState__)+
"."+this.items[b].__collection__.name);return a.toString()};tent.entities.ContextChangeHandler=function(a){this.context=a};tent.entities.ContextChangeHandler.prototype.isDetached=function(a){return!a.__changeState__||a.__changeState__==tent.entities.ChangeStates.DETACHED};tent.entities.ContextChangeHandler.prototype.bindArrayProperties=function(a){if(a.__entityType__)for(var b in a.__entityType__.properties){var d=a.__entityType__.properties[b];if(d.cardinality&&d.cardinality.substr(1,1)!="1"&&a[b]instanceof
Array){a[b].__parent__=a;a[b].__propertyName__=b;tent.changes.bind(a[b],this)}}};tent.entities.ContextChangeHandler.prototype.unbindArrayProperties=function(a){if(a.__entityType__)for(var b in a.__entityType__.properties){var d=a.__entityType__.properties[b];d.cardinality&&d.cardinality.substr(1,1)!="1"&&a[b]instanceof Array&&tent.changes.unbind(a[b],this)}};tent.entities.ContextChangeHandler.prototype.setAdded=function(a){if(a.__changeState__!=tent.entities.ChangeStates.ADDED)if(a.__collection__)if(a.__collection__.context==
this.context){a.__changeState__=tent.entities.ChangeStates.ADDED;if(!this.context.changes)this.context.changes=new tent.entities.ContextChanges(this.context);this.context.changes.items.pushUnique(a)}else throw"cannot set this item as ADDED, it belongs to another Context";else a.__changeState__=tent.entities.ChangeStates.ADDED};tent.entities.ContextChangeHandler.prototype.setRemoved=function(a){if(!(this.isDetached(a)||a.__changeState__==tent.entities.ChangeStates.DELETED))if(a.__collection__)if(a.__collection__.context==
this.context)if(a.__changeState__==tent.entities.ChangeStates.UNCHANGED||a.__changeState__==tent.entities.ChangeStates.MODIFIED){a.__changeState__=tent.entities.ChangeStates.DELETED;if(!this.context.changes)this.context.changes=new tent.entities.ContextChanges(this.context);this.context.changes.items.pushUnique(a)}else{if(a.__changeState__==tent.entities.ChangeStates.ADDED){a.__changeState__=tent.entities.ChangeStates.DETACHED;delete a.__collection__;if(!this.context.changes)this.context.changes=
new tent.entities.ContextChanges(this.context);this.context.changes.items.remove(a)}}else throw"cannot set this item as DELETED, it belongs to another Context";else a.__changeState__=tent.entities.ChangeStates.DELETED};tent.entities.ContextChangeHandler.prototype.touch=function(){for(var a=0,b=arguments.length;a<b;a++)if(arguments[a]&&arguments[a].__changeState__==tent.entities.ChangeStates.UNCHANGED&&arguments[a].__collection__&&arguments[a].__collection__.context==this.context){if(!this.context.changes)this.context.changes=
new tent.entities.ContextChanges(this);arguments[a].__changeState__=tent.entities.ChangeStates.MODIFIED;this.context.changes.items.pushUnique(arguments[a])}};tent.entities.ContextChangeHandler.prototype.itemAdded=function(a){if(this.isDetached(a))this.setAdded(a);else if(a.__changeState__!=tent.entities.ChangeStates.UNCHANGED){if(!this.context.changes)this.context.changes=new tent.entities.ContextChanges(this.context);this.context.changes.items.pushUnique(a)}if(a.__changeState__!=tent.entities.ChangeStates.DELETED){tent.changes.bind(a,
this);this.bindArrayProperties(a)}};tent.entities.ContextChangeHandler.prototype.itemAttached=function(a){if(this.isDetached(a))a.__changeState__=tent.entities.ChangeStates.UNCHANGED;this.itemAdded(a)};tent.entities.ContextChangeHandler.prototype.itemRemoved=function(a){this.setRemoved(a);tent.changes.unbind(a,this);this.unbindArrayProperties(a)};tent.entities.ContextChangeHandler.prototype.itemDetached=function(a){var b=this.context.changes;a.__changeState__!=tent.entities.ChangeStates.UNCHANGED&&
b&&b.items.remove(a);delete a.__changeState__;tent.changes.unbind(a,this);this.unbindArrayProperties(a)};tent.entities.ContextChangeHandler.prototype.objectLinked=function(a,b,d,f){if(typeof f=="object")if(f instanceof Array){if(f.__parent__!=a){if(f.__parent__)throw"this array already has another parent object";f.__parent__=a}if(f.__propertyName__!=b)f.__propertyName__=b;tent.changes.bind(f,this);d.onLinkPush&&this.context.attach.push(this.context,f)}else if(f!==null&&typeof f!="undefined"){if(f.__changeState__==
tent.entities.ChangeStates.DELETED)throw'cannot link a DELETED object to property "'+d+'"';if(f.__collection__){if(f.__collection__.context!=this.context)throw"cannot link this object, it belongs to another Context";if(d.collection&&f.__collection__.name!=d.collection)throw"cannot link an object of collection "+d.collection+' to property "'+d+'"';}if(!f.__collection__&&d.onLinkPush){f.__entityType__&&this.context.push(f.__entityType__);if(d.collection){if(!this.context.__collections__[d.collection])throw Error('Collection "'+
d.collection+'" not found in this Context');this.context.__collections__[d.collection].push(f)}else this.context.push(f)}if(d.trackLinks){d=null;for(var g=this.context.changes.items.length-1;g>=0;g--){var j=this.context.changes.items[g];if(j instanceof tent.entities.EntityLink&&j.from===a&&j.to===f&&j.propertyName==b){d=j;break}}if(d){if(d.__changeState__==tent.entities.ChangeStates.DELETED)d.__changeState__=tent.entities.ChangeStates.UNCHANGED}else{d=new tent.entities.EntityLink(a,f,b,tent.entities.ChangeStates.ADDED);
this.context.changes.items.push(d)}}}};tent.entities.ContextChangeHandler.prototype.objectUnlinked=function(a,b,d,f){if(typeof f=="object")if(f instanceof Array){delete f.__parent__;delete f.__propertyName__;tent.changes.unbind(f,this);d.onUnlinkRemove&&this.context.remove.apply(this.context,f)}else if(f!==null&&typeof f!="undefined"){d.onUnlinkRemove&&f.__collection__&&f.__collection__.remove(f);if(d.trackLinks){d=null;for(var g=-1,j=this.context.changes.items.length-1;j>=0;j--){var c=this.context.changes.items[j];
if(c instanceof tent.entities.EntityLink&&c.from===a&&c.to===f&&c.propertyName==b){d=c;g=j;break}}if(d)if(d.__changeState__==tent.entities.ChangeStates.ADDED)this.context.changes.items.splice(g,1);else{if(d.__changeState__!=tent.entities.ChangeStates.DELETED)d.__changeState__=tent.entities.ChangeStates.DELETED}else{d=new tent.entities.EntityLink(a,f,b,tent.entities.ChangeStates.DELETED);this.context.changes.items.push(d)}}}};tent.entities.ContextChangeHandler.prototype.getTrackedProperty=function(a,
b){var d;if(a.__entityType__&&a.__changeState__&&a.__changeState__!=tent.entities.ChangeStates.DELETED&&a.__changeState__!=tent.entities.ChangeStates.DETACHED&&a.__collection__&&a.__collection__.context==this.context&&(d=a.__entityType__.properties[b]))return d};tent.entities.ContextChangeHandler.prototype.handle=function(a){if(a.subject){var b;if(a.eventType==tent.changes.EventTypes.CHANGED)if(a.subject.__entityType__){if(b=this.getTrackedProperty(a.subject,a.data.propertyName)){this.context.touch(a.subject);
this.objectUnlinked(a.subject,a.data.propertyName,b,a.data.oldValue);this.objectLinked(a.subject,a.data.propertyName,b,a.data.current)}}else this.context.touch(a.subject);else if(a.eventType==tent.changes.EventTypes.ADDED){var d=a.subject.__parent__;if(d&&(b=this.getTrackedProperty(d,a.data.propertyName)))for(var f=0,g=a.data.items.length;f<g;f++)this.objectLinked(d,a.data.propertyName,b,a.data.items[f])}else if(a.eventType==tent.changes.EventTypes.REMOVED)if((d=a.subject.__parent__)&&(b=this.getTrackedProperty(d,
a.data.propertyName))){f=0;for(g=a.data.items.length;f<g;f++)this.objectUnlinked(d,a.data.propertyName,b,a.data.items[f])}tent.changes.reverseProperties.getHandler()(a)}};tent.entities.ContextChangeHandler.prototype.init=function(){if(this.context.log)var a=new tent.coreTypes.NameCounter;for(var b in this.context.__collections__){for(var d=this.context.__collections__[b],f=0,g=d.items.length;f<g;f++)this.itemAttached(d.items[f]);a&&a.add(b,d.items.length)}if(this.context.log)a&&a.root._count>0?tent.log.debug("Context: initialized with "+
a):tent.log.debug("Context: initialized empty")};tent.entities.ContextChangeHandler.prototype.acceptChanges=function(){if(this.context.hasChanges()){this.context.log&&tent.log.debug("Context: accepting changes, "+this.context.changes);for(var a=this.context.changes.items,b=0,d=a.length;b<d;b++)a[b].__changeState__=tent.entities.ChangeStates.UNCHANGED;a.length=0;this.context.log&&tent.log.debug("Context: all changes accepted")}}});
